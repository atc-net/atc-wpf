<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:inputs="clr-namespace:Atc.Wpf.Controls.Inputs">

    <!--  Thumb style for RangeSlider  -->
    <Style x:Key="AtcApps.Styles.RangeSlider.Thumb" TargetType="{x:Type Thumb}">
        <Setter Property="Background" Value="{DynamicResource AtcApps.Brushes.Accent}" />
        <Setter Property="BorderBrush" Value="{DynamicResource AtcApps.Brushes.ThemeBackground}" />
        <Setter Property="BorderThickness" Value="2" />
        <Setter Property="Cursor" Value="Hand" />
        <Setter Property="Focusable" Value="True" />
        <Setter Property="SnapsToDevicePixels" Value="True" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Thumb}">
                    <Grid>
                        <Ellipse
                            x:Name="thumbEllipse"
                            Width="{Binding ThumbSize, RelativeSource={RelativeSource AncestorType={x:Type inputs:RangeSlider}}}"
                            Height="{Binding ThumbSize, RelativeSource={RelativeSource AncestorType={x:Type inputs:RangeSlider}}}"
                            Fill="{Binding ThumbBrush, RelativeSource={RelativeSource AncestorType={x:Type inputs:RangeSlider}}, TargetNullValue={StaticResource AtcApps.Brushes.Accent}}"
                            Stroke="{TemplateBinding BorderBrush}"
                            StrokeThickness="2" />
                        <Popup
                            x:Name="valuePopup"
                            AllowsTransparency="True"
                            IsOpen="False"
                            Placement="Top"
                            PlacementTarget="{Binding ElementName=thumbEllipse}"
                            VerticalOffset="-5">
                            <Border
                                Padding="6,3"
                                Background="{DynamicResource AtcApps.Brushes.ThemeBackground}"
                                BorderBrush="{DynamicResource AtcApps.Brushes.Accent}"
                                BorderThickness="1"
                                CornerRadius="3">
                                <TextBlock
                                    x:Name="valueText"
                                    FontSize="11"
                                    Foreground="{DynamicResource AtcApps.Brushes.Text}" />
                            </Border>
                        </Popup>
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="thumbEllipse" Property="Fill" Value="{Binding ThumbHoverBrush, RelativeSource={RelativeSource AncestorType={x:Type inputs:RangeSlider}}, TargetNullValue={StaticResource AtcApps.Brushes.Accent2}}" />
                        </Trigger>
                        <Trigger Property="IsDragging" Value="True">
                            <Setter TargetName="thumbEllipse" Property="Fill" Value="{Binding ThumbPressedBrush, RelativeSource={RelativeSource AncestorType={x:Type inputs:RangeSlider}}, TargetNullValue={StaticResource AtcApps.Brushes.Accent3}}" />
                        </Trigger>
                        <Trigger Property="IsFocused" Value="True">
                            <Setter TargetName="thumbEllipse" Property="Stroke" Value="{DynamicResource AtcApps.Brushes.Accent}" />
                            <Setter TargetName="thumbEllipse" Property="StrokeThickness" Value="3" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!--  Main RangeSlider style  -->
    <Style x:Key="AtcApps.Styles.RangeSlider" TargetType="{x:Type inputs:RangeSlider}">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="Focusable" Value="True" />
        <Setter Property="Height" Value="32" />
        <Setter Property="MinWidth" Value="100" />
        <Setter Property="RangeHighlightBrush" Value="{DynamicResource AtcApps.Brushes.Accent}" />
        <Setter Property="SnapsToDevicePixels" Value="True" />
        <Setter Property="ThumbBrush" Value="{DynamicResource AtcApps.Brushes.Accent}" />
        <Setter Property="ThumbHoverBrush" Value="{DynamicResource AtcApps.Brushes.Accent2}" />
        <Setter Property="ThumbPressedBrush" Value="{DynamicResource AtcApps.Brushes.Accent3}" />
        <Setter Property="TrackBackground" Value="{DynamicResource AtcApps.Brushes.Gray6}" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type inputs:RangeSlider}">
                    <Border
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}">
                        <Grid VerticalAlignment="Center">
                            <!--  Track background  -->
                            <Canvas
                                x:Name="PART_Track"
                                Height="{TemplateBinding TrackHeight}"
                                VerticalAlignment="Center">
                                <!--  Full track  -->
                                <Border
                                    Width="{Binding ActualWidth, ElementName=PART_Track}"
                                    Height="{TemplateBinding TrackHeight}"
                                    Background="{TemplateBinding TrackBackground}"
                                    CornerRadius="2" />

                                <!--  Selected range highlight  -->
                                <Border
                                    x:Name="PART_RangeHighlight"
                                    Height="{TemplateBinding TrackHeight}"
                                    Background="{TemplateBinding RangeHighlightBrush}"
                                    CornerRadius="2" />

                                <!--  Lower thumb  -->
                                <Thumb
                                    x:Name="PART_LowerThumb"
                                    Style="{StaticResource AtcApps.Styles.RangeSlider.Thumb}"
                                    ToolTip="{Binding RangeStart, RelativeSource={RelativeSource TemplatedParent}, StringFormat={}{0:N0}}">
                                    <Canvas.Top>
                                        <MultiBinding Converter="{x:Static inputs:RangeSliderThumbOffsetConverter.Instance}">
                                            <Binding Path="TrackHeight" RelativeSource="{RelativeSource TemplatedParent}" />
                                            <Binding Path="ThumbSize" RelativeSource="{RelativeSource TemplatedParent}" />
                                        </MultiBinding>
                                    </Canvas.Top>
                                </Thumb>

                                <!--  Upper thumb  -->
                                <Thumb
                                    x:Name="PART_UpperThumb"
                                    Style="{StaticResource AtcApps.Styles.RangeSlider.Thumb}"
                                    ToolTip="{Binding RangeEnd, RelativeSource={RelativeSource TemplatedParent}, StringFormat={}{0:N0}}">
                                    <Canvas.Top>
                                        <MultiBinding Converter="{x:Static inputs:RangeSliderThumbOffsetConverter.Instance}">
                                            <Binding Path="TrackHeight" RelativeSource="{RelativeSource TemplatedParent}" />
                                            <Binding Path="ThumbSize" RelativeSource="{RelativeSource TemplatedParent}" />
                                        </MultiBinding>
                                    </Canvas.Top>
                                </Thumb>
                            </Canvas>
                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>
