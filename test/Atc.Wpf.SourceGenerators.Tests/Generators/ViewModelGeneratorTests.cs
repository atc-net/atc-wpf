namespace Atc.Wpf.SourceGenerators.Tests.Generators;

[SuppressMessage("Design", "MA0051:Method is too long", Justification = "OK.")]
public sealed class ViewModelGeneratorTests : GeneratorTestBase
{
    [Fact]
    public void GeneratorViewModel_ObservableProperty_Name()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [ObservableProperty]
                private string name;
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            
            namespace TestNamespace;
            
            public partial class TestViewModel
            {
                public string Name
                {
                    get => name;
                    set
                    {
                        if (name == value)
                        {
                            return;
                        }
            
                        name = value;
                        RaisePropertyChanged(nameof(Name));
                    }
                }
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_ObservableProperty_CustomName()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [ObservableProperty("MyName)]
                private string name;
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public string MyName
                {
                    get => name;
                    set
                    {
                        if (name == value)
                        {
                            return;
                        }
            
                        name = value;
                        RaisePropertyChanged(nameof(MyName));
                    }
                }
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_ObservableProperty_Name_SealedAccessor()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public sealed partial class TestViewModel : ViewModelBase
            {
                [ObservableProperty]
                private string name;
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public string Name
                {
                    get => name;
                    set
                    {
                        if (name == value)
                        {
                            return;
                        }
            
                        name = value;
                        RaisePropertyChanged(nameof(Name));
                    }
                }
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_ObservableProperty_Name_MainWindowViewModel()
    {
        const string inputCode =
            """
            namespace TestNamespace;
            
            public sealed partial class MainWindowViewModel : MainWindowViewModelBase
            {
                private readonly ILogger<MainWindowViewModel> logger;
                private BitmapImage? icon;
            
                public MainWindowViewModel(
                    ILogger<MainWindowViewModel> logger,
                    StatusBarViewModel statusBarViewModel,
                    IOptions<BasicApplicationOptions> applicationOptions)
                {
                    this.logger = logger;
            
                    Test = "Hello World";
                }
            
                [ObservableProperty]
                private string? name;
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable

            namespace TestNamespace;

            public partial class MainWindowViewModel
            {
                public string? Name
                {
                    get => name;
                    set
                    {
                        if (name == value)
                        {
                            return;
                        }
            
                        name = value;
                        RaisePropertyChanged(nameof(Name));
                    }
                }
            }

            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_ClassName_Invalid()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class Test : ViewModelBase
            {
                [ObservableProperty]
                private string name;
            }
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultIsEmpty(generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_ClassAccessor_Invalid()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public class TestViewModel : ViewModelBase
            {
                [ObservableProperty]
                private string name;
            }
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultIsEmpty(generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_ObservableProperty_Name_Invalid_AccessorPublic()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [ObservableProperty]
                public string name;
            }
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultIsEmpty(generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_ObservableProperty_Name_Invalid_AccessorProtected()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [ObservableProperty]
                protected string name;
            }
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultIsEmpty(generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_ObservableProperty_Name_Invalid_AccessorInternal()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [ObservableProperty]
                internal string name;
            }
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultIsEmpty(generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_ObservableProperty_Name_Invalid_Casing()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [ObservableProperty]
                private string Name;
            }
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultIsEmpty(generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_ObservableProperties_With_NotifyPropertiesChangedFor()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class PersonViewModel : ViewModelBase
            {
                [ObservableProperty]
                [NotifyPropertyChangedFor(nameof(FullName))]
                private string firstName = string.Empty;
            
                [ObservableProperty]
                [NotifyPropertyChangedFor(nameof(FullName), nameof(Age))]
                [NotifyPropertyChangedFor(nameof(Email))]
                [NotifyPropertyChangedFor(nameof(TheProperty))]
                private string? lastName;
            
                [ObservableProperty]
                private int? age;
            
                [ObservableProperty]
                private string? email;
            
                [ObservableProperty("TheProperty", nameof(FullName), nameof(Age))]
                private string? myTestProperty;
            
                public string FullName => $"{FirstName} {LastName}";
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            
            namespace TestNamespace;
            
            public partial class PersonViewModel
            {
                public string FirstName
                {
                    get => firstName;
                    set
                    {
                        if (firstName == value)
                        {
                            return;
                        }

                        firstName = value;
                        RaisePropertyChanged(nameof(FirstName));
                        RaisePropertyChanged(nameof(FullName));
                    }
                }

                public string? LastName
                {
                    get => lastName;
                    set
                    {
                        if (lastName == value)
                        {
                            return;
                        }

                        lastName = value;
                        RaisePropertyChanged(nameof(LastName));
                        RaisePropertyChanged(nameof(FullName));
                        RaisePropertyChanged(nameof(Age));
                        RaisePropertyChanged(nameof(Email));
                        RaisePropertyChanged(nameof(TheProperty));
                    }
                }

                public int? Age
                {
                    get => age;
                    set
                    {
                        if (age == value)
                        {
                            return;
                        }

                        age = value;
                        RaisePropertyChanged(nameof(Age));
                    }
                }

                public string? Email
                {
                    get => email;
                    set
                    {
                        if (email == value)
                        {
                            return;
                        }

                        email = value;
                        RaisePropertyChanged(nameof(Email));
                    }
                }

                public string? TheProperty
                {
                    get => myTestProperty;
                    set
                    {
                        if (myTestProperty == value)
                        {
                            return;
                        }

                        myTestProperty = value;
                        RaisePropertyChanged(nameof(TheProperty));
                        RaisePropertyChanged(nameof(FullName));
                        RaisePropertyChanged(nameof(Age));
                    }
                }
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_RelayCommand_NoParameter()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand]
                public void Save()
                {
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommand SaveCommand => new RelayCommand(Save);
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_RelayCommand_NoParameter_CustomName()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand("MySave")]
                public void Save()
                {
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommand MySaveCommand => new RelayCommand(Save);
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_RelayCommand_NoParameter_MethodHandlerName()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand]
                public void SaveHandler()
                {
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommand SaveCommand => new RelayCommand(SaveHandler);
            }

            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_RelayCommand_ParameterString()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand]
                public void Save(string val)
                {
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommand<string> SaveCommand => new RelayCommand<string>(Save);
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_RelayCommand_ParameterInt()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand]
                public void Save(int val)
                {
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommand<int> SaveCommand => new RelayCommand<int>(Save);
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_RelayCommand_ParameterTuple()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand]
                public void Save((LeftTopRightBottomType DirectionType, int StepMoves) data)
                {
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommand<(LeftTopRightBottomType DirectionType, int StepMoves)> SaveCommand => new RelayCommand<(LeftTopRightBottomType DirectionType, int StepMoves)>(Save);
            }

            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_RelayCommand_NoParameter_CanExecute()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand(CanExecute = nameof(CanSave))]
                public void Save()
                {
                }
                
                public bool CanSave()
                {
                    return true;
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommand SaveCommand => new RelayCommand(Save, CanSave);
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_RelayCommand_ParameterString_CanExecute()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand(CanExecute = nameof(CanSave))]
                public void Save(string val)
                {
                }
                
                public bool CanSave()
                {
                    return true;
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommand<string> SaveCommand => new RelayCommand<string>(Save, CanSave);
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_RelayCommand_ParameterInt_CanExecute()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand(CanExecute = nameof(CanSave))]
                public void Save(int val)
                {
                }
                
                public bool CanSave()
                {
                    return true;
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommand<int> SaveCommand => new RelayCommand<int>(Save, CanSave);
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_RelayCommand_ParameterValue_Single()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand(ParameterValue = LeftTopRightBottomType.Left)]
                public void TurnDirectionSingle(LeftTopRightBottomType leftTopRightBottomType)
                {
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommand TurnDirectionSingleCommand => new RelayCommand(() => TurnDirectionSingle(LeftTopRightBottomType.Left));
            }

            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_RelayCommand_ParameterValue_Multi()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand("MyTestLeft", ParameterValue = LeftTopRightBottomType.Left)]
                [RelayCommand("MyTestTop", ParameterValue = LeftTopRightBottomType.Top)]
                [RelayCommand("MyTestRight", ParameterValue = LeftTopRightBottomType.Right)]
                [RelayCommand("MyTestBottom", ParameterValue = LeftTopRightBottomType.Bottom)]
                public void TurnDirectionSingle(LeftTopRightBottomType leftTopRightBottomType)
                {
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommand MyTestLeftCommand => new RelayCommand(() => TurnDirectionSingle(LeftTopRightBottomType.Left));

                public IRelayCommand MyTestTopCommand => new RelayCommand(() => TurnDirectionSingle(LeftTopRightBottomType.Top));

                public IRelayCommand MyTestRightCommand => new RelayCommand(() => TurnDirectionSingle(LeftTopRightBottomType.Right));

                public IRelayCommand MyTestBottomCommand => new RelayCommand(() => TurnDirectionSingle(LeftTopRightBottomType.Bottom));
            }

            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_RelayCommand_ParameterValues_Multi()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand("MyTestLeft", ParameterValues = [LeftTopRightBottomType.Left, 1])]
                [RelayCommand("MyTestTop", ParameterValues = [LeftTopRightBottomType.Top, 1])]
                [RelayCommand("MyTestRight", ParameterValues = [LeftTopRightBottomType.Right, 1])]
                [RelayCommand("MyTestBottom", ParameterValues = [LeftTopRightBottomType.Bottom, 1])]
                public void TurnDirectionSingle(LeftTopRightBottomType leftTopRightBottomType, int steps)
                {
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommand MyTestLeftCommand => new RelayCommand(() => TurnDirectionSingle(LeftTopRightBottomType.Left, 1));
            
                public IRelayCommand MyTestTopCommand => new RelayCommand(() => TurnDirectionSingle(LeftTopRightBottomType.Top, 1));
            
                public IRelayCommand MyTestRightCommand => new RelayCommand(() => TurnDirectionSingle(LeftTopRightBottomType.Right, 1));
            
                public IRelayCommand MyTestBottomCommand => new RelayCommand(() => TurnDirectionSingle(LeftTopRightBottomType.Bottom, 1));
            }

            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_AsyncRelayCommand_NoParameter()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand]
                public Task Save()
                {
                    return Task.CompletedTask;
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommandAsync SaveCommand => new RelayCommandAsync(Save);
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_AsyncRelayCommand_NoParameter_MethodHandlerName()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand]
                public Task SaveHandler()
                {
                    return Task.CompletedTask;
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommandAsync SaveCommand => new RelayCommandAsync(SaveHandler);
            }

            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_AsyncRelayCommand_NoParameter_CustomName()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand("MySave")]
                public Task Save()
                {
                    return Task.CompletedTask;
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommandAsync MySaveCommand => new RelayCommandAsync(Save);
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_AsyncRelayCommand_ParameterString()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand]
                public Task Save(string val)
                {
                    return Task.CompletedTask;
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommandAsync<string> SaveCommand => new RelayCommandAsync<string>(Save);
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_AsyncRelayCommand_ParameterInt()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand]
                public Task Save(int val)
                {
                    return Task.CompletedTask;
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommandAsync<int> SaveCommand => new RelayCommandAsync<int>(Save);
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_AsyncRelayCommand_ParameterTuple()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand]
                public Task Save((LeftTopRightBottomType DirectionType, int StepMoves) data)
                {
                    return Task.CompletedTask;
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommandAsync<(LeftTopRightBottomType DirectionType, int StepMoves)> SaveCommand => new RelayCommandAsync<(LeftTopRightBottomType DirectionType, int StepMoves)>(Save);
            }

            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_AsyncRelayCommand_NoParameter_CanExecute()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand(CanExecute = nameof(CanSave))]
                public Task Save()
                {
                    return Task.CompletedTask;
                }
                
                public bool CanSave()
                {
                    return true;
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommandAsync SaveCommand => new RelayCommandAsync(Save, CanSave);
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_AsyncRelayCommand_ParameterString_CanExecute()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand(CanExecute = nameof(CanSave))]
                public Task Save(string val)
                {
                    return Task.CompletedTask;
                }
                
                public bool CanSave(string val)
                {
                    return true;
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommandAsync<string> SaveCommand => new RelayCommandAsync<string>(Save, CanSave);
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_AsyncRelayCommand_ParameterInt_CanExecute()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand(CanExecute = nameof(CanSave))]
                public Task Save(int val)
                {
                    return Task.CompletedTask;
                }

                public bool CanSave(int val)
                {
                    return true;
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommandAsync<int> SaveCommand => new RelayCommandAsync<int>(Save, CanSave);
            }
            
            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_AsyncRelayCommand_ParameterValue_Single()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand(ParameterValue = LeftTopRightBottomType.Left)]
                public Task TurnDirectionSingle(LeftTopRightBottomType leftTopRightBottomType)
                {
                    return Task.CompletedTask;
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommandAsync TurnDirectionSingleCommand => new RelayCommandAsync(() => TurnDirectionSingle(LeftTopRightBottomType.Left));
            }

            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_AsyncRelayCommand_ParameterValue_Multi()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand("MyTestLeft", ParameterValue = LeftTopRightBottomType.Left)]
                [RelayCommand("MyTestTop", ParameterValue = LeftTopRightBottomType.Top)]
                [RelayCommand("MyTestRight", ParameterValue = LeftTopRightBottomType.Right)]
                [RelayCommand("MyTestBottom", ParameterValue = LeftTopRightBottomType.Bottom)]
                public Task TurnDirectionSingle(LeftTopRightBottomType leftTopRightBottomType)
                {
                    return Task.CompletedTask;
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommandAsync MyTestLeftCommand => new RelayCommandAsync(() => TurnDirectionSingle(LeftTopRightBottomType.Left));
            
                public IRelayCommandAsync MyTestTopCommand => new RelayCommandAsync(() => TurnDirectionSingle(LeftTopRightBottomType.Top));
            
                public IRelayCommandAsync MyTestRightCommand => new RelayCommandAsync(() => TurnDirectionSingle(LeftTopRightBottomType.Right));
            
                public IRelayCommandAsync MyTestBottomCommand => new RelayCommandAsync(() => TurnDirectionSingle(LeftTopRightBottomType.Bottom));
            }

            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }

    [Fact]
    public void GeneratorViewModel_AsyncRelayCommand_ParameterValues_Multi()
    {
        const string inputCode =
            """
            namespace TestNamespace;

            public partial class TestViewModel : ViewModelBase
            {
                [RelayCommand("MyTestLeft", ParameterValues = [LeftTopRightBottomType.Left, 1])]
                [RelayCommand("MyTestTop", ParameterValues = [LeftTopRightBottomType.Top, 1])]
                [RelayCommand("MyTestRight", ParameterValues = [LeftTopRightBottomType.Right, 1])]
                [RelayCommand("MyTestBottom", ParameterValues = [LeftTopRightBottomType.Bottom, 1])]
                public Task TurnDirectionSingle(LeftTopRightBottomType leftTopRightBottomType, int steps)
                {
                    return Task.CompletedTask;
                }
            }
            """;

        const string expectedCode =
            """
            // <auto-generated>
            #nullable enable
            using Atc.Wpf.Command;

            namespace TestNamespace;

            public partial class TestViewModel
            {
                public IRelayCommandAsync MyTestLeftCommand => new RelayCommandAsync(() => TurnDirectionSingle(LeftTopRightBottomType.Left, 1));
            
                public IRelayCommandAsync MyTestTopCommand => new RelayCommandAsync(() => TurnDirectionSingle(LeftTopRightBottomType.Top, 1));
            
                public IRelayCommandAsync MyTestRightCommand => new RelayCommandAsync(() => TurnDirectionSingle(LeftTopRightBottomType.Right, 1));
            
                public IRelayCommandAsync MyTestBottomCommand => new RelayCommandAsync(() => TurnDirectionSingle(LeftTopRightBottomType.Bottom, 1));
            }

            #nullable disable
            """;

        var generatorResult = GeneratorViewModel(inputCode);

        AssertGeneratorRunResultAsEqual(expectedCode, generatorResult);
    }
}